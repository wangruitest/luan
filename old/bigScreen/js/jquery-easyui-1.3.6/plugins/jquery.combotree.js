(function(b){function c(i){var h=b.data(i,"combotree");var g=h.options;var f=h.tree;b(i).addClass("combotree-f");b(i).combo(g);var e=b(i).combo("panel");if(!f){f=b("<ul></ul>").appendTo(e);b.data(i,"combotree").tree=f}f.tree(b.extend({},g,{checkbox:g.multiple,onLoadSuccess:function(n,m){var l=b(i).combotree("getValues");if(g.multiple){var r=f.tree("getChecked");for(var k=0;k<r.length;k++){var j=r[k].id;(function(){for(var s=0;s<l.length;s++){if(j==l[s]){return}}l.push(j)})()}}var q=b(this).tree("options");var p=q.onCheck;var o=q.onSelect;q.onCheck=q.onSelect=function(){};b(i).combotree("setValues",l);q.onCheck=p;q.onSelect=o;g.onLoadSuccess.call(this,n,m)},onClick:function(j){if(g.multiple){b(this).tree(j.checked?"uncheck":"check",j.target)}else{b(i).combo("hidePanel")}d(i);g.onClick.call(this,j)},onCheck:function(k,j){d(i);g.onCheck.call(this,k,j)}}))}function d(k){var j=b.data(k,"combotree");var h=j.options;var g=j.tree;var m=[],n=[];if(h.multiple){var f=g.tree("getChecked");for(var l=0;l<f.length;l++){m.push(f[l].id);n.push(f[l].text)}}else{var e=g.tree("getSelected");if(e){m.push(e.id);n.push(e.text)}}b(k).combo("setValues",m).combo("setText",n.join(h.separator))}function a(e,j){var h=b.data(e,"combotree").options;var g=b.data(e,"combotree").tree;g.find("span.tree-checkbox").addClass("tree-checkbox0").removeClass("tree-checkbox1 tree-checkbox2");var l=[],o=[];for(var k=0;k<j.length;k++){var m=j[k];var n=m;var f=g.tree("find",m);if(f){n=f.text;g.tree("check",f.target);g.tree("select",f.target)}l.push(m);o.push(n)}b(e).combo("setValues",l).combo("setText",o.join(h.separator))}b.fn.combotree=function(g,e){if(typeof g=="string"){var f=b.fn.combotree.methods[g];if(f){return f(this,e)}else{return this.combo(g,e)}}g=g||{};return this.each(function(){var h=b.data(this,"combotree");if(h){b.extend(h.options,g)}else{b.data(this,"combotree",{options:b.extend({},b.fn.combotree.defaults,b.fn.combotree.parseOptions(this),g)})}c(this)})};b.fn.combotree.methods={options:function(f){var e=f.combo("options");return b.extend(b.data(f[0],"combotree").options,{originalValue:e.originalValue,disabled:e.disabled,readonly:e.readonly})},tree:function(e){return b.data(e[0],"combotree").tree},loadData:function(f,e){return f.each(function(){var h=b.data(this,"combotree").options;h.data=e;var g=b.data(this,"combotree").tree;g.tree("loadData",e)})},reload:function(f,e){return f.each(function(){var h=b.data(this,"combotree").options;var g=b.data(this,"combotree").tree;if(e){h.url=e}g.tree({url:h.url})})},setValues:function(f,e){return f.each(function(){a(this,e)})},setValue:function(f,e){return f.each(function(){a(this,[e])})},clear:function(e){return e.each(function(){var g=b.data(this,"combotree").tree;g.find("div.tree-node-selected").removeClass("tree-node-selected");var h=g.tree("getChecked");for(var f=0;f<h.length;f++){g.tree("uncheck",h[f].target)}b(this).combo("clear")})},reset:function(e){return e.each(function(){var f=b(this).combotree("options");if(f.multiple){b(this).combotree("setValues",f.originalValue)}else{b(this).combotree("setValue",f.originalValue)}})}};b.fn.combotree.parseOptions=function(e){return b.extend({},b.fn.combo.parseOptions(e),b.fn.tree.parseOptions(e))};b.fn.combotree.defaults=b.extend({},b.fn.combo.defaults,b.fn.tree.defaults,{editable:false})})(jQuery);