(function(d){var e;function c(h){var g=d.data(h,"propertygrid");var f=d.data(h,"propertygrid").options;d(h).datagrid(d.extend({},f,{cls:"propertygrid",view:(f.showGroup?f.groupView:f.view),onClickRow:function(k,j){if(e!=this){a(e);e=this}if(f.editIndex!=k&&j.editor){var i=d(this).datagrid("getColumnOption","value");i.editor=j.editor;a(e);d(this).datagrid("beginEdit",k);d(this).datagrid("getEditors",k)[0].target.focus();f.editIndex=k}f.onClickRow.call(h,k,j)},loadFilter:function(i){a(this);return f.loadFilter.call(this,i)}}));d(document).unbind(".propertygrid").bind("mousedown.propertygrid",function(j){var i=d(j.target).closest("div.datagrid-view,div.combo-panel");if(i.length){return}a(e);e=undefined})}function a(i){var j=d(i);if(!j.length){return}var h=d.data(i,"propertygrid").options;var f=h.editIndex;if(f==undefined){return}var g=j.datagrid("getEditors",f)[0];if(g){g.target.blur();if(j.datagrid("validateRow",f)){j.datagrid("endEdit",f)}else{j.datagrid("cancelEdit",f)}}h.editIndex=undefined}d.fn.propertygrid=function(f,h){if(typeof f=="string"){var g=d.fn.propertygrid.methods[f];if(g){return g(this,h)}else{return this.datagrid(f,h)}}f=f||{};return this.each(function(){var j=d.data(this,"propertygrid");if(j){d.extend(j.options,f)}else{var i=d.extend({},d.fn.propertygrid.defaults,d.fn.propertygrid.parseOptions(this),f);i.frozenColumns=d.extend(true,[],i.frozenColumns);i.columns=d.extend(true,[],i.columns);d.data(this,"propertygrid",{options:i})}c(this)})};d.fn.propertygrid.methods={options:function(f){return d.data(f[0],"propertygrid").options}};d.fn.propertygrid.parseOptions=function(f){return d.extend({},d.fn.datagrid.parseOptions(f),d.parser.parseOptions(f,[{showGroup:"boolean"}]))};var b=d.extend({},d.fn.datagrid.defaults.view,{render:function(l,k,h){var g=[];var f=this.groups;for(var j=0;j<f.length;j++){g.push(this.renderGroup.call(this,l,j,f[j],h))}d(k).html(g.join(""))},renderGroup:function(q,o,n,m){var l=d.data(q,"datagrid");var k=l.options;var i=d(q).datagrid("getColumnFields",m);var h=[];h.push('<div class="datagrid-group" group-index='+o+">");h.push('<table cellspacing="0" cellpadding="0" border="0" style="height:100%"><tbody>');h.push("<tr>");if((m&&(k.rownumbers||k.frozenColumns.length))||(!m&&!(k.rownumbers||k.frozenColumns.length))){h.push('<td style="border:0;text-align:center;width:25px"><span class="datagrid-row-expander datagrid-row-collapse" style="display:inline-block;width:16px;height:16px;cursor:pointer">&nbsp;</span></td>')}h.push('<td style="border:0;">');if(!m){h.push('<span class="datagrid-group-title">');h.push(k.groupFormatter.call(q,n.value,n.rows));h.push("</span>")}h.push("</td>");h.push("</tr>");h.push("</tbody></table>");h.push("</div>");h.push('<table class="datagrid-btable" cellspacing="0" cellpadding="0" border="0"><tbody>');var g=n.startIndex;for(var p=0;p<n.rows.length;p++){var r=k.rowStyler?k.rowStyler.call(q,g,n.rows[p]):"";var f="";var v="";if(typeof r=="string"){v=r}else{if(r){f=r["class"]||"";v=r.style||""}}var u='class="datagrid-row '+(g%2&&k.striped?"datagrid-row-alt ":" ")+f+'"';var t=v?'style="'+v+'"':"";var s=l.rowIdPrefix+"-"+(m?1:2)+"-"+g;h.push('<tr id="'+s+'" datagrid-row-index="'+g+'" '+u+" "+t+">");h.push(this.renderRow.call(this,q,i,m,g,n.rows[p]));h.push("</tr>");g++}h.push("</tbody></table>");return h.join("")},bindEvents:function(i){var h=d.data(i,"datagrid");var f=h.dc;var g=f.body1.add(f.body2);var j=(d.data(g[0],"events")||d._data(g[0],"events")).click[0].handler;g.unbind("click").bind("click",function(n){var l=d(n.target);var m=l.closest("span.datagrid-row-expander");if(m.length){var k=m.closest("div.datagrid-group").attr("group-index");if(m.hasClass("datagrid-row-collapse")){d(i).datagrid("collapseGroup",k)}else{d(i).datagrid("expandGroup",k)}}else{j(n)}n.stopPropagation()})},onBeforeRender:function(r,q){var p=d.data(r,"datagrid");var o=p.options;n();var m=[];for(var f=0;f<q.length;f++){var s=q[f];var l=k(s[o.groupField]);if(!l){l={value:s[o.groupField],rows:[s]};m.push(l)}else{l.rows.push(s)}}var j=0;var h=[];for(var f=0;f<m.length;f++){var l=m[f];l.startIndex=j;j+=l.rows.length;h=h.concat(l.rows)}p.data.rows=h;this.groups=m;var g=this;setTimeout(function(){g.bindEvents(r)},0);function k(v){for(var t=0;t<m.length;t++){var u=m[t];if(u.value==v){return u}}return null}function n(){if(!d("#datagrid-group-style").length){d("head").append('<style id="datagrid-group-style">.datagrid-group{height:25px;overflow:hidden;font-weight:bold;border-bottom:1px solid #ccc;}</style>')}}}});d.extend(d.fn.datagrid.methods,{expandGroup:function(g,f){return g.each(function(){var j=d.data(this,"datagrid").dc.view;var i=j.find(f!=undefined?'div.datagrid-group[group-index="'+f+'"]':"div.datagrid-group");var h=i.find("span.datagrid-row-expander");if(h.hasClass("datagrid-row-expand")){h.removeClass("datagrid-row-expand").addClass("datagrid-row-collapse");i.next("table").show()}d(this).datagrid("fixRowHeight")})},collapseGroup:function(g,f){return g.each(function(){var i=d.data(this,"datagrid").dc.view;var j=i.find(f!=undefined?'div.datagrid-group[group-index="'+f+'"]':"div.datagrid-group");var h=j.find("span.datagrid-row-expander");if(h.hasClass("datagrid-row-collapse")){h.removeClass("datagrid-row-collapse").addClass("datagrid-row-expand");j.next("table").hide()}d(this).datagrid("fixRowHeight")})}});d.fn.propertygrid.defaults=d.extend({},d.fn.datagrid.defaults,{singleSelect:true,remoteSort:false,fitColumns:true,loadMsg:"",frozenColumns:[[{field:"f",width:16,resizable:false}]],columns:[[{field:"name",title:"Name",width:100,sortable:true},{field:"value",title:"Value",width:100,resizable:false}]],showGroup:false,groupView:b,groupField:"group",groupFormatter:function(g,f){return g}})})(jQuery);