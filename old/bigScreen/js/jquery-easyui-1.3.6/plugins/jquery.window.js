(function(f){function g(k,j){var i=f.data(k,"window").options;if(j){f.extend(i,j)}f(k).panel("resize",i)}function e(k,j){var i=f.data(k,"window");if(j){if(j.left!=null){i.options.left=j.left}if(j.top!=null){i.options.top=j.top}}f(k).panel("move",i.options);if(i.shadow){i.shadow.css({left:i.options.left,top:i.options.top})}}function b(m,l){var k=f.data(m,"window");var j=k.options;var i=j.width;if(isNaN(i)){i=k.window._outerWidth()}if(j.inline){var n=k.window.parent();j.left=(n.width()-i)/2+n.scrollLeft()}else{j.left=(f(window)._outerWidth()-i)/2+f(document).scrollLeft()}if(l){e(m)}}function h(n,m){var l=f.data(n,"window");var k=l.options;var j=k.height;if(isNaN(j)){j=l.window._outerHeight()}if(k.inline){var i=l.window.parent();k.top=(i.height()-j)/2+i.scrollTop()}else{k.top=(f(window)._outerHeight()-j)/2+f(document).scrollTop()}if(m){e(n)}}function d(j){var i=f.data(j,"window");var k=i.options.closed;var l=f(j).panel(f.extend({},i.options,{border:false,doSize:true,closed:true,cls:"window",headerCls:"window-header",bodyCls:"window-body "+(i.options.noheader?"window-body-noheader":""),onBeforeDestroy:function(){if(i.options.onBeforeDestroy.call(j)==false){return false}if(i.shadow){i.shadow.remove()}if(i.mask){i.mask.remove()}},onClose:function(){if(i.shadow){i.shadow.hide()}if(i.mask){i.mask.hide()}i.options.onClose.call(j)},onOpen:function(){if(i.mask){i.mask.css({display:"block",zIndex:f.fn.window.defaults.zIndex++})}if(i.shadow){i.shadow.css({display:"block",zIndex:f.fn.window.defaults.zIndex++,left:i.options.left,top:i.options.top,width:i.window._outerWidth(),height:i.window._outerHeight()})}i.window.css("z-index",f.fn.window.defaults.zIndex++);i.options.onOpen.call(j)},onResize:function(o,n){var m=f(this).panel("options");f.extend(i.options,{width:m.width,height:m.height,left:m.left,top:m.top});if(i.shadow){i.shadow.css({left:i.options.left,top:i.options.top,width:i.window._outerWidth(),height:i.window._outerHeight()})}i.options.onResize.call(j,o,n)},onMinimize:function(){if(i.shadow){i.shadow.hide()}if(i.mask){i.mask.hide()}i.options.onMinimize.call(j)},onBeforeCollapse:function(){if(i.options.onBeforeCollapse.call(j)==false){return false}if(i.shadow){i.shadow.hide()}},onExpand:function(){if(i.shadow){i.shadow.show()}i.options.onExpand.call(j)}}));i.window=l.panel("panel");if(i.mask){i.mask.remove()}if(i.options.modal==true){i.mask=f('<div class="window-mask"></div>').insertAfter(i.window);i.mask.css({width:(i.options.inline?i.mask.parent().width():c().width),height:(i.options.inline?i.mask.parent().height():c().height),display:"none"})}if(i.shadow){i.shadow.remove()}if(i.options.shadow==true){i.shadow=f('<div class="window-shadow"></div>').insertAfter(i.window);i.shadow.css({display:"none"})}if(i.options.left==null){b(j)}if(i.options.top==null){h(j)}e(j);if(!k){l.window("open")}}function a(j){var i=f.data(j,"window");i.window.draggable({handle:">div.panel-header>div.panel-title",disabled:i.options.draggable==false,onStartDrag:function(k){if(i.mask){i.mask.css("z-index",f.fn.window.defaults.zIndex++)}if(i.shadow){i.shadow.css("z-index",f.fn.window.defaults.zIndex++)}i.window.css("z-index",f.fn.window.defaults.zIndex++);if(!i.proxy){i.proxy=f('<div class="window-proxy"></div>').insertAfter(i.window)}i.proxy.css({display:"none",zIndex:f.fn.window.defaults.zIndex++,left:k.data.left,top:k.data.top});i.proxy._outerWidth(i.window._outerWidth());i.proxy._outerHeight(i.window._outerHeight());setTimeout(function(){if(i.proxy){i.proxy.show()}},500)},onDrag:function(k){i.proxy.css({display:"block",left:k.data.left,top:k.data.top});return false},onStopDrag:function(k){i.options.left=k.data.left;i.options.top=k.data.top;f(j).window("move");i.proxy.remove();i.proxy=null}});i.window.resizable({disabled:i.options.resizable==false,onStartResize:function(k){i.pmask=f('<div class="window-proxy-mask"></div>').insertAfter(i.window);i.pmask.css({zIndex:f.fn.window.defaults.zIndex++,left:k.data.left,top:k.data.top,width:i.window._outerWidth(),height:i.window._outerHeight()});if(!i.proxy){i.proxy=f('<div class="window-proxy"></div>').insertAfter(i.window)}i.proxy.css({zIndex:f.fn.window.defaults.zIndex++,left:k.data.left,top:k.data.top});i.proxy._outerWidth(k.data.width);i.proxy._outerHeight(k.data.height)},onResize:function(k){i.proxy.css({left:k.data.left,top:k.data.top});i.proxy._outerWidth(k.data.width);i.proxy._outerHeight(k.data.height);return false},onStopResize:function(k){f.extend(i.options,{left:k.data.left,top:k.data.top,width:k.data.width,height:k.data.height});g(j);i.pmask.remove();i.pmask=null;i.proxy.remove();i.proxy=null}})}function c(){if(document.compatMode=="BackCompat"){return{width:Math.max(document.body.scrollWidth,document.body.clientWidth),height:Math.max(document.body.scrollHeight,document.body.clientHeight)}}else{return{width:Math.max(document.documentElement.scrollWidth,document.documentElement.clientWidth),height:Math.max(document.documentElement.scrollHeight,document.documentElement.clientHeight)}}}f(window).resize(function(){f("body>div.window-mask").css({width:f(window)._outerWidth(),height:f(window)._outerHeight()});setTimeout(function(){f("body>div.window-mask").css({width:c().width,height:c().height})},50)});f.fn.window=function(k,j){if(typeof k=="string"){var i=f.fn.window.methods[k];if(i){return i(this,j)}else{return this.panel(k,j)}}k=k||{};return this.each(function(){var l=f.data(this,"window");if(l){f.extend(l.options,k)}else{l=f.data(this,"window",{options:f.extend({},f.fn.window.defaults,f.fn.window.parseOptions(this),k)});if(!l.options.inline){document.body.appendChild(this)}}d(this);a(this)})};f.fn.window.methods={options:function(k){var j=k.panel("options");var i=f.data(k[0],"window").options;return f.extend(i,{closed:j.closed,collapsed:j.collapsed,minimized:j.minimized,maximized:j.maximized})},window:function(i){return f.data(i[0],"window").window},resize:function(j,i){return j.each(function(){g(this,i)})},move:function(j,i){return j.each(function(){e(this,i)})},hcenter:function(i){return i.each(function(){b(this,true)})},vcenter:function(i){return i.each(function(){h(this,true)})},center:function(i){return i.each(function(){b(this);h(this);e(this)})}};f.fn.window.parseOptions=function(i){return f.extend({},f.fn.panel.parseOptions(i),f.parser.parseOptions(i,[{draggable:"boolean",resizable:"boolean",shadow:"boolean",modal:"boolean",inline:"boolean"}]))};f.fn.window.defaults=f.extend({},f.fn.panel.defaults,{zIndex:9000,draggable:true,resizable:true,shadow:true,modal:false,inline:false,title:"New Window",collapsible:true,minimizable:true,maximizable:true,closable:true,closed:false})})(jQuery);