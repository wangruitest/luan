(function(e){function f(j){var i=e.data(j,"datetimebox");var h=i.options;e(j).datebox(e.extend({},h,{onShowPanel:function(){var l=e(j).datetimebox("getValue");c(j,l,true);h.onShowPanel.call(j)},formatter:e.fn.datebox.defaults.formatter,parser:e.fn.datebox.defaults.parser}));e(j).removeClass("datebox-f").addClass("datetimebox-f");e(j).datebox("calendar").calendar({onSelect:function(l){h.onSelect.call(j,l)}});var g=e(j).datebox("panel");if(!i.spinner){var k=e('<div style="padding:2px"><input style="width:80px"></div>').insertAfter(g.children("div.datebox-calendar-inner"));i.spinner=k.children("input")}i.spinner.timespinner({showSeconds:h.showSeconds,separator:h.timeSeparator}).unbind(".datetimebox").bind("mousedown.datetimebox",function(l){l.stopPropagation()});c(j,h.value)}function b(i){var j=e(i).datetimebox("calendar");var h=e(i).datetimebox("spinner");var g=j.calendar("options").current;return new Date(g.getFullYear(),g.getMonth(),g.getDate(),h.timespinner("getHours"),h.timespinner("getMinutes"),h.timespinner("getSeconds"))}function d(g,h){c(g,h,true)}function a(i){var h=e.data(i,"datetimebox").options;var g=b(i);c(i,h.formatter.call(i,g));e(i).combo("hidePanel")}function c(l,k,j){var i=e.data(l,"datetimebox").options;e(l).combo("setValue",k);if(!j){if(k){var h=i.parser.call(l,k);e(l).combo("setValue",i.formatter.call(l,h));e(l).combo("setText",i.formatter.call(l,h))}else{e(l).combo("setText",k)}}var h=i.parser.call(l,k);e(l).datetimebox("calendar").calendar("moveTo",h);e(l).datetimebox("spinner").timespinner("setValue",g(h));function g(n){function m(p){return(p<10?"0":"")+p}var o=[m(n.getHours()),m(n.getMinutes())];if(i.showSeconds){o.push(m(n.getSeconds()))}return o.join(e(l).datetimebox("spinner").timespinner("options").separator)}}e.fn.datetimebox=function(i,h){if(typeof i=="string"){var g=e.fn.datetimebox.methods[i];if(g){return g(this,h)}else{return this.datebox(i,h)}}i=i||{};return this.each(function(){var j=e.data(this,"datetimebox");if(j){e.extend(j.options,i)}else{e.data(this,"datetimebox",{options:e.extend({},e.fn.datetimebox.defaults,e.fn.datetimebox.parseOptions(this),i)})}f(this)})};e.fn.datetimebox.methods={options:function(h){var g=h.datebox("options");return e.extend(e.data(h[0],"datetimebox").options,{originalValue:g.originalValue,disabled:g.disabled,readonly:g.readonly})},spinner:function(g){return e.data(g[0],"datetimebox").spinner},setValue:function(h,g){return h.each(function(){c(this,g)})},reset:function(g){return g.each(function(){var h=e(this).datetimebox("options");e(this).datetimebox("setValue",h.originalValue)})}};e.fn.datetimebox.parseOptions=function(h){var g=e(h);return e.extend({},e.fn.datebox.parseOptions(h),e.parser.parseOptions(h,["timeSeparator",{showSeconds:"boolean"}]))};e.fn.datetimebox.defaults=e.extend({},e.fn.datebox.defaults,{showSeconds:true,timeSeparator:":",keyHandler:{up:function(g){},down:function(g){},left:function(g){},right:function(g){},enter:function(g){a(this)},query:function(g,h){d(this,g)}},buttons:[{text:function(g){return e(g).datetimebox("options").currentText},handler:function(g){e(g).datetimebox("calendar").calendar({year:new Date().getFullYear(),month:new Date().getMonth()+1,current:new Date()});a(g)}},{text:function(g){return e(g).datetimebox("options").okText},handler:function(g){a(g)}},{text:function(g){return e(g).datetimebox("options").closeText},handler:function(g){e(this).closest("div.combo-panel").panel("close")}}],formatter:function(g){var k=g.getHours();var n=g.getMinutes();var j=g.getSeconds();function m(h){return(h<10?"0":"")+h}var i=e(this).datetimebox("spinner").timespinner("options").separator;var l=e.fn.datebox.defaults.formatter(g)+" "+m(k)+i+m(n);if(e(this).datetimebox("options").showSeconds){l+=i+m(j)}return l},parser:function(l){if(e.trim(l)==""){return new Date()}var m=l.split(" ");var n=e.fn.datebox.defaults.parser(m[0]);if(m.length<2){return n}var j=e(this).datetimebox("spinner").timespinner("options").separator;var k=m[1].split(j);var i=parseInt(k[0],10)||0;var g=parseInt(k[1],10)||0;var h=parseInt(k[2],10)||0;return new Date(n.getFullYear(),n.getMonth(),n.getDate(),i,g,h)}})})(jQuery);