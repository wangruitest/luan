(function(b){function c(j){var i=b.data(j,"datebox");var h=i.options;b(j).addClass("datebox-f").combo(b.extend({},h,{onShowPanel:function(){g();e(j,b(j).datebox("getText"),true);h.onShowPanel.call(j)}}));b(j).combo("textbox").parent().addClass("datebox");if(!i.calendar){f()}e(j,h.value);function f(){var n=b(j).combo("panel").css("overflow","hidden");n.panel("options").onBeforeDestroy=function(){var t=b(this).find(".calendar-shared");if(t.length){t.insertBefore(t[0].pholder)}};var k=b('<div class="datebox-calendar-inner"></div>').appendTo(n);if(h.sharedCalendar){var o=b(h.sharedCalendar);if(!o[0].pholder){o[0].pholder=b('<div class="calendar-pholder" style="display:none"></div>').insertAfter(o)}o.addClass("calendar-shared").appendTo(k);if(!o.hasClass("calendar")){o.calendar()}i.calendar=o}else{i.calendar=b("<div></div>").appendTo(k).calendar()}b.extend(i.calendar.calendar("options"),{fit:true,border:false,onSelect:function(u){var t=b(this.target).datebox("options");e(this.target,t.formatter.call(this.target,u));b(this.target).combo("hidePanel");t.onSelect.call(j,u)}});var r=b('<div class="datebox-button"><table cellspacing="0" cellpadding="0" style="width:100%"><tr></tr></table></div>').appendTo(n);var p=r.find("tr");for(var m=0;m<h.buttons.length;m++){var l=b("<td></td>").appendTo(p);var q=h.buttons[m];var s=b('<a href="javascript:void(0)"></a>').html(b.isFunction(q.text)?q.text(j):q.text).appendTo(l);s.bind("click",{target:j,handler:q.handler},function(t){t.data.handler.call(this,t.data.target)})}p.find("td").css("width",(100/h.buttons.length)+"%")}function g(){var l=b(j).combo("panel");var m=l.children("div.datebox-calendar-inner");l.children()._outerWidth(l.width());i.calendar.appendTo(m);i.calendar[0].target=j;if(h.panelHeight!="auto"){var k=l.height();l.children().not(m).each(function(){k-=b(this).outerHeight()});m._outerHeight(k)}i.calendar.calendar("resize")}}function a(g,f){e(g,f,true)}function d(i){var h=b.data(i,"datebox");var g=h.options;var f=h.calendar.calendar("options").current;if(f){e(i,g.formatter.call(i,f));b(i).combo("hidePanel")}}function e(j,h,g){var f=b.data(j,"datebox");var k=f.options;var i=f.calendar;b(j).combo("setValue",h);i.calendar("moveTo",k.parser.call(j,h));if(!g){if(h){h=k.formatter.call(j,i.calendar("options").current);b(j).combo("setValue",h).combo("setText",h)}else{b(j).combo("setText",h)}}}b.fn.datebox=function(h,g){if(typeof h=="string"){var f=b.fn.datebox.methods[h];if(f){return f(this,g)}else{return this.combo(h,g)}}h=h||{};return this.each(function(){var i=b.data(this,"datebox");if(i){b.extend(i.options,h)}else{b.data(this,"datebox",{options:b.extend({},b.fn.datebox.defaults,b.fn.datebox.parseOptions(this),h)})}c(this)})};b.fn.datebox.methods={options:function(g){var f=g.combo("options");return b.extend(b.data(g[0],"datebox").options,{originalValue:f.originalValue,disabled:f.disabled,readonly:f.readonly})},calendar:function(f){return b.data(f[0],"datebox").calendar},setValue:function(g,f){return g.each(function(){e(this,f)})},reset:function(f){return f.each(function(){var g=b(this).datebox("options");b(this).datebox("setValue",g.originalValue)})}};b.fn.datebox.parseOptions=function(f){return b.extend({},b.fn.combo.parseOptions(f),b.parser.parseOptions(f,["sharedCalendar"]))};b.fn.datebox.defaults=b.extend({},b.fn.combo.defaults,{panelWidth:180,panelHeight:"auto",sharedCalendar:null,keyHandler:{up:function(f){},down:function(f){},left:function(f){},right:function(f){},enter:function(f){d(this)},query:function(f,g){a(this,f)}},currentText:"Today",closeText:"Close",okText:"Ok",buttons:[{text:function(f){return b(f).datebox("options").currentText},handler:function(f){b(f).datebox("calendar").calendar({year:new Date().getFullYear(),month:new Date().getMonth()+1,current:new Date()});d(f)}},{text:function(f){return b(f).datebox("options").closeText},handler:function(f){b(this).closest("div.combo-panel").panel("close")}}],formatter:function(g){var i=g.getFullYear();var f=g.getMonth()+1;var h=g.getDate();return f+"/"+h+"/"+i},parser:function(g){var f=Date.parse(g);if(!isNaN(f)){return new Date(f)}else{return new Date()}},onSelect:function(f){}})})(jQuery);