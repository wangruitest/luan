(function(b){function c(k){var j=b.data(k,"menubutton").options;var i=b(k);i.linkbutton(j);i.removeClass(j.cls.btn1+" "+j.cls.btn2).addClass("m-btn");i.removeClass("m-btn-small m-btn-medium m-btn-large").addClass("m-btn-"+j.size);var h=i.find(".l-btn-left");b("<span></span>").addClass(j.cls.arrow).appendTo(h);b("<span></span>").addClass("m-btn-line").appendTo(h);if(j.menu){b(j.menu).menu();var g=b(j.menu).menu("options");var f=g.onShow;var e=g.onHide;b.extend(g,{onShow:function(){var l=b(this).menu("options");var n=b(l.alignTo);var m=n.menubutton("options");n.addClass((m.plain==true)?m.cls.btn2:m.cls.btn1);f.call(this)},onHide:function(){var n=b(this).menu("options");var m=b(n.alignTo);var l=m.menubutton("options");m.removeClass((l.plain==true)?l.cls.btn2:l.cls.btn1);e.call(this)}})}d(k,j.disabled)}function d(j,i){var h=b.data(j,"menubutton").options;h.disabled=i;var f=b(j);var e=f.find("."+h.cls.trigger);if(!e.length){e=f}e.unbind(".menubutton");if(i){f.linkbutton("disable")}else{f.linkbutton("enable");var g=null;e.bind("click.menubutton",function(){a(j);return false}).bind("mouseenter.menubutton",function(){g=setTimeout(function(){a(j)},h.duration);return false}).bind("mouseleave.menubutton",function(){if(g){clearTimeout(g)}})}}function a(g){var f=b.data(g,"menubutton").options;if(f.disabled||!f.menu){return}b("body>div.menu-top").menu("hide");var e=b(g);var h=b(f.menu);if(h.length){h.menu("options").alignTo=e;h.menu("show",{alignTo:e,align:f.menuAlign})}e.blur()}b.fn.menubutton=function(g,f){if(typeof g=="string"){var e=b.fn.menubutton.methods[g];if(e){return e(this,f)}else{return this.linkbutton(g,f)}}g=g||{};return this.each(function(){var h=b.data(this,"menubutton");if(h){b.extend(h.options,g)}else{b.data(this,"menubutton",{options:b.extend({},b.fn.menubutton.defaults,b.fn.menubutton.parseOptions(this),g)});b(this).removeAttr("disabled")}c(this)})};b.fn.menubutton.methods={options:function(g){var f=g.linkbutton("options");var e=b.data(g[0],"menubutton").options;e.toggle=f.toggle;e.selected=f.selected;return e},enable:function(e){return e.each(function(){d(this,false)})},disable:function(e){return e.each(function(){d(this,true)})},destroy:function(e){return e.each(function(){var f=b(this).menubutton("options");if(f.menu){b(f.menu).menu("destroy")}b(this).remove()})}};b.fn.menubutton.parseOptions=function(e){var f=b(e);return b.extend({},b.fn.linkbutton.parseOptions(e),b.parser.parseOptions(e,["menu",{plain:"boolean",duration:"number"}]))};b.fn.menubutton.defaults=b.extend({},b.fn.linkbutton.defaults,{plain:true,menu:null,menuAlign:"left",duration:100,cls:{btn1:"m-btn-active",btn2:"m-btn-plain-active",arrow:"m-btn-downarrow",trigger:"m-btn"}})})(jQuery);