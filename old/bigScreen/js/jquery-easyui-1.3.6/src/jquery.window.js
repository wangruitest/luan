(function(e){function h(j,k){var i=e.data(j,"window").options;if(k){e.extend(i,k)}e(j).panel("resize",i)}function d(j,k){var i=e.data(j,"window");if(k){if(k.left!=null){i.options.left=k.left}if(k.top!=null){i.options.top=k.top}}e(j).panel("move",i.options);if(i.shadow){i.shadow.css({left:i.options.left,top:i.options.top})}}function f(n,i){var m=e.data(n,"window");var l=m.options;var k=l.width;if(isNaN(k)){k=m.window._outerWidth()}if(l.inline){var j=m.window.parent();l.left=(j.width()-k)/2+j.scrollLeft()}else{l.left=(e(window)._outerWidth()-k)/2+e(document).scrollLeft()}if(i){d(n)}}function c(n,j){var m=e.data(n,"window");var l=m.options;var i=l.height;if(isNaN(i)){i=m.window._outerHeight()}if(l.inline){var k=m.window.parent();l.top=(k.height()-i)/2+k.scrollTop()}else{l.top=(e(window)._outerHeight()-i)/2+e(document).scrollTop()}if(j){d(n)}}function b(l){var j=e.data(l,"window");var i=j.options.closed;var k=e(l).panel(e.extend({},j.options,{border:false,doSize:true,closed:true,cls:"window",headerCls:"window-header",bodyCls:"window-body "+(j.options.noheader?"window-body-noheader":""),onBeforeDestroy:function(){if(j.options.onBeforeDestroy.call(l)==false){return false}if(j.shadow){j.shadow.remove()}if(j.mask){j.mask.remove()}},onClose:function(){if(j.shadow){j.shadow.hide()}if(j.mask){j.mask.hide()}j.options.onClose.call(l)},onOpen:function(){if(j.mask){j.mask.css({display:"block",zIndex:e.fn.window.defaults.zIndex++})}if(j.shadow){j.shadow.css({display:"block",zIndex:e.fn.window.defaults.zIndex++,left:j.options.left,top:j.options.top,width:j.window._outerWidth(),height:j.window._outerHeight()})}j.window.css("z-index",e.fn.window.defaults.zIndex++);j.options.onOpen.call(l)},onResize:function(n,m){var o=e(this).panel("options");e.extend(j.options,{width:o.width,height:o.height,left:o.left,top:o.top});if(j.shadow){j.shadow.css({left:j.options.left,top:j.options.top,width:j.window._outerWidth(),height:j.window._outerHeight()})}j.options.onResize.call(l,n,m)},onMinimize:function(){if(j.shadow){j.shadow.hide()}if(j.mask){j.mask.hide()}j.options.onMinimize.call(l)},onBeforeCollapse:function(){if(j.options.onBeforeCollapse.call(l)==false){return false}if(j.shadow){j.shadow.hide()}},onExpand:function(){if(j.shadow){j.shadow.show()}j.options.onExpand.call(l)}}));j.window=k.panel("panel");if(j.mask){j.mask.remove()}if(j.options.modal==true){j.mask=e('<div class="window-mask"></div>').insertAfter(j.window);j.mask.css({width:(j.options.inline?j.mask.parent().width():g().width),height:(j.options.inline?j.mask.parent().height():g().height),display:"none"})}if(j.shadow){j.shadow.remove()}if(j.options.shadow==true){j.shadow=e('<div class="window-shadow"></div>').insertAfter(j.window);j.shadow.css({display:"none"})}if(j.options.left==null){f(l)}if(j.options.top==null){c(l)}d(l);if(!i){k.window("open")}}function a(j){var i=e.data(j,"window");i.window.draggable({handle:">div.panel-header>div.panel-title",disabled:i.options.draggable==false,onStartDrag:function(k){if(i.mask){i.mask.css("z-index",e.fn.window.defaults.zIndex++)}if(i.shadow){i.shadow.css("z-index",e.fn.window.defaults.zIndex++)}i.window.css("z-index",e.fn.window.defaults.zIndex++);if(!i.proxy){i.proxy=e('<div class="window-proxy"></div>').insertAfter(i.window)}i.proxy.css({display:"none",zIndex:e.fn.window.defaults.zIndex++,left:k.data.left,top:k.data.top});i.proxy._outerWidth(i.window._outerWidth());i.proxy._outerHeight(i.window._outerHeight());setTimeout(function(){if(i.proxy){i.proxy.show()}},500)},onDrag:function(k){i.proxy.css({display:"block",left:k.data.left,top:k.data.top});return false},onStopDrag:function(k){i.options.left=k.data.left;i.options.top=k.data.top;e(j).window("move");i.proxy.remove();i.proxy=null}});i.window.resizable({disabled:i.options.resizable==false,onStartResize:function(k){i.pmask=e('<div class="window-proxy-mask"></div>').insertAfter(i.window);i.pmask.css({zIndex:e.fn.window.defaults.zIndex++,left:k.data.left,top:k.data.top,width:i.window._outerWidth(),height:i.window._outerHeight()});if(!i.proxy){i.proxy=e('<div class="window-proxy"></div>').insertAfter(i.window)}i.proxy.css({zIndex:e.fn.window.defaults.zIndex++,left:k.data.left,top:k.data.top});i.proxy._outerWidth(k.data.width);i.proxy._outerHeight(k.data.height)},onResize:function(k){i.proxy.css({left:k.data.left,top:k.data.top});i.proxy._outerWidth(k.data.width);i.proxy._outerHeight(k.data.height);return false},onStopResize:function(k){e.extend(i.options,{left:k.data.left,top:k.data.top,width:k.data.width,height:k.data.height});h(j);i.pmask.remove();i.pmask=null;i.proxy.remove();i.proxy=null}})}function g(){if(document.compatMode=="BackCompat"){return{width:Math.max(document.body.scrollWidth,document.body.clientWidth),height:Math.max(document.body.scrollHeight,document.body.clientHeight)}}else{return{width:Math.max(document.documentElement.scrollWidth,document.documentElement.clientWidth),height:Math.max(document.documentElement.scrollHeight,document.documentElement.clientHeight)}}}e(window).resize(function(){e("body>div.window-mask").css({width:e(window)._outerWidth(),height:e(window)._outerHeight()});setTimeout(function(){e("body>div.window-mask").css({width:g().width,height:g().height})},50)});e.fn.window=function(i,j){if(typeof i=="string"){var k=e.fn.window.methods[i];if(k){return k(this,j)}else{return this.panel(i,j)}}i=i||{};return this.each(function(){var l=e.data(this,"window");if(l){e.extend(l.options,i)}else{l=e.data(this,"window",{options:e.extend({},e.fn.window.defaults,e.fn.window.parseOptions(this),i)});if(!l.options.inline){document.body.appendChild(this)}}b(this);a(this)})};e.fn.window.methods={options:function(k){var j=k.panel("options");var i=e.data(k[0],"window").options;return e.extend(i,{closed:j.closed,collapsed:j.collapsed,minimized:j.minimized,maximized:j.maximized})},window:function(i){return e.data(i[0],"window").window},resize:function(j,i){return j.each(function(){h(this,i)})},move:function(j,i){return j.each(function(){d(this,i)})},hcenter:function(i){return i.each(function(){f(this,true)})},vcenter:function(i){return i.each(function(){c(this,true)})},center:function(i){return i.each(function(){f(this);c(this);d(this)})}};e.fn.window.parseOptions=function(i){return e.extend({},e.fn.panel.parseOptions(i),e.parser.parseOptions(i,[{draggable:"boolean",resizable:"boolean",shadow:"boolean",modal:"boolean",inline:"boolean"}]))};e.fn.window.defaults=e.extend({},e.fn.panel.defaults,{zIndex:9000,draggable:true,resizable:true,shadow:true,modal:false,inline:false,title:"New Window",collapsible:true,minimizable:true,maximizable:true,closable:true,closed:false})})(jQuery);